<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>客户点餐界面</title>
</head>
<body>
<h1>欢迎点餐</h1>

<h2>菜单</h2>
<div id="menu"></div>

<h2>购物车</h2>
<button onclick="viewCart()">查看购物车</button>
<div id="cart"></div>

<button onclick="checkout()">结账</button>

<script>
    const userId = 1; // 模拟固定用户

    async function loadMenu() {
        const res = await fetch("http://localhost:8089/api/menu/view?userId=" + userId);
        const data = await res.json();
        const menuEl = document.getElementById("menu");
        menuEl.innerHTML = data.items.map(item => `
        <p>
          商品ID: ${item.productId}, 价格: ${item.price}
          <button onclick="addToCart(${item.productId}, ${item.price})">加入购物车</button>
        </p>
      `).join("");
    }

    async function addToCart(productId, price) {
        await fetch(`http://localhost:8081/api/cart/add?userId=${userId}&productId=${productId}&quantity=1&price=${price}`, {
            method: 'POST'
        });
        alert("已加入购物车");
    }

    async function viewCart() {
        const res = await fetch(`http://localhost:8081/api/cart/view?userId=${userId}`);
        const data = await res.json();
        document.getElementById("cart").innerHTML = data.items.map(i =>
            `<p>商品 ${i.productId}, 数量: ${i.quantity}, 单价: ${i.price}</p>`
        ).join("");
    }

    async function checkout() {
        const res = await fetch(`http://localhost:8082/api/order/checkout?userId=${userId}`, {
            method: "POST"
        });
        const order = await res.json();
        alert(`下单成功！订单号: ${order.id}`);
        viewCart();
    }

    loadMenu();
</script>
</body>
</html>
